<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <script src="../../fs-globals/fs-globals-mock.js"></script>
    <script src="../../axe.min/index.js" ></script>
    <link rel="stylesheet" href="../../fs-styles/dist/familysearch-styles.css">


    <!-- Step 1: import the element to test -->
    <link rel="import" href="../fs-dialog-all.html">
  </head>
  <body>

    <!-- Use the document as a place to set up your fixtures. -->
    <test-fixture id="fs-modal-dialog-fixture">
      <template>
        <fs-modal-dialog>
          <header>
            <h4>Modal</h4>
          </header>
          <div class="fs-dialog__body">
            <p>This is a modal dialog. It really stands out from the content and forces the user to perform an action before they can continue.</p>
          </div>
          <footer>
            <button class="fs-button fs-button--recommended" data-dialog-confirm>Done</button>
            <button class="fs-button" data-dialog-dismiss>Cancel</button>
          </footer>
        </fs-modal-dialog>
      </template>
    </test-fixture>
    <test-fixture id="fs-anchored-dialog-fixture">
      <template>
        <fs-anchored-dialog>
          <header>
            <h4>anchored</h4>
          </header>
          <div class="fs-dialog__body">
            <p>This is a anchored dialog. It really stands out from the content and forces the user to perform an action before they can continue.</p>
          </div>
          <footer>
            <button class="fs-button fs-button--recommended" data-dialog-confirm>Done</button>
            <button class="fs-button" data-dialog-dismiss>Cancel</button>
          </footer>
        </fs-anchored-dialog>
      </template>
    </test-fixture>
    <test-fixture id="fs-modeless-dialog-fixture">
      <template>
        <fs-modeless-dialog>
          <header>
            <h4>modeless</h4>
          </header>
          <div class="fs-dialog__body">
            <p>This is a modeless dialog. It really stands out from the content and forces the user to perform an action before they can continue.</p>
          </div>
          <footer>
            <button class="fs-button fs-button--recommended" data-dialog-confirm>Done</button>
            <button class="fs-button" data-dialog-dismiss>Cancel</button>
          </footer>
        </fs-modeless-dialog>
      </template>
    </test-fixture>

    <script>

      document.addEventListener('WebComponentsReady', function(){

        describe('fs-modal-dialog', function() {
          var el;

          beforeEach(function() {
            el = fixture('fs-modal-dialog-fixture');
          });

          afterEach(function() {
            el.close();
            el.remove();
          });

          describe('a11y', function() {

            it('should pass accessibility guidelines', function(done) {
              el.open();

              axe.run(function (err, results) {
                if (err) return done(err);

                if (results.violations.length || results.incomplete.length) {
                  var errMsg = '';

                  results.violations.forEach(function(violation) {
                    errMsg += `\n\n${violation.help}:`;

                    violation.nodes.forEach(function(node, index) {
                      errMsg += `\n\t${index+1}: ${node.html}`;
                    });
                  });

                  results.incomplete.forEach(function(incomplete) {
                    errMsg += `\n\n${incomplete.help}:`;

                    incomplete.nodes.forEach(function(node, index) {
                      errMsg += `\n\t${index+1}: ${node.html}`;
                    });
                  });

                  var error = new Error(errMsg+'\n');
                  error.stack = null;

                  return done(error)
                }

                done();
              });

            });

          });

        });

        describe('fs-anchored-dialog', function() {
          var el;

          beforeEach(function() {
            el = fixture('fs-anchored-dialog-fixture');
          });

          afterEach(function() {
            el.close();
            el.remove();
          });

          describe('a11y', function() {

            it('should pass accessibility guidelines', function(done) {
              el.open();

              axe.run(function (err, results) {
                if (err) return done(err);

                if (results.violations.length || results.incomplete.length) {
                  var errMsg = '';

                  results.violations.forEach(function(violation) {
                    errMsg += `\n\n${violation.help}:`;

                    violation.nodes.forEach(function(node, index) {
                      errMsg += `\n\t${index+1}: ${node.html}`;
                    });
                  });

                  results.incomplete.forEach(function(incomplete) {
                    errMsg += `\n\n${incomplete.help}:`;

                    incomplete.nodes.forEach(function(node, index) {
                      errMsg += `\n\t${index+1}: ${node.html}`;
                    });
                  });

                  var error = new Error(errMsg+'\n');
                  error.stack = null;

                  return done(error)
                }

                done();
              });

            });

          });

        });

        describe('fs-modeless-dialog', function() {
          var el;

          beforeEach(function() {
            el = fixture('fs-modeless-dialog-fixture');
          });

          afterEach(function() {
            el.close();
            el.remove();
          });

          describe('a11y', function() {

            it('should pass accessibility guidelines', function(done) {
              el.open();

              axe.run(function (err, results) {
                if (err) return done(err);

                if (results.violations.length || results.incomplete.length) {
                  var errMsg = '';

                  results.violations.forEach(function(violation) {
                    errMsg += `\n\n${violation.help}:`;

                    violation.nodes.forEach(function(node, index) {
                      errMsg += `\n\t${index+1}: ${node.html}`;
                    });
                  });

                  results.incomplete.forEach(function(incomplete) {
                    errMsg += `\n\n${incomplete.help}:`;

                    incomplete.nodes.forEach(function(node, index) {
                      errMsg += `\n\t${index+1}: ${node.html}`;
                    });
                  });

                  var error = new Error(errMsg+'\n');
                  error.stack = null;

                  return done(error)
                }

                done();
              });

            });

          });

        });

      });
    </script>
  </body>
</html>
