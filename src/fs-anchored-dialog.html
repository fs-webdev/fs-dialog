<link rel="import" href="../fs-globals/fs-globals.html">
<link rel="import" href="../fs-dialog/fs-dialog-base.html">

<style data-fs-anchored-dialog>

</style>

<script>
(function() {
  var doc = (document._currentScript || document.currentScript).ownerDocument;

  var fsAnchoredDialog = Object.create(FS.dialog.baseDialogComponent);

  /**
   * Initialize the popover, add events, and accessibility features. Should only change
   * the DOM on attached callback otherwise it breaks Polymer bindings.
   */
  fsAnchoredDialog.attachedCallback = function () {
    var root = this.getRootNode();

    // In polyfilled browsers there is no shadow DOM so global styles still style
    // the "fake" shadow DOM. We need to test for truly native support so we know
    // when to inject styles into the shadow DOM. The best way I've found to do that
    // is to test the toString output of a shadowroot since `instanceof ShadowRoot`
    // returns true when it's just a document-fragment in polyfilled browsers
    // @see https://stackoverflow.com/questions/45068560/using-a-non-shadow-dom-custom-element-both-inside-and-outside-the-shadow-dom
    if (root.toString() === '[object ShadowRoot]' && !root.querySelector('style[data-fs-anchored-dialog]')) {
      var styles = doc.querySelector('style[data-fs-anchored-dialog]').cloneNode(true);
      root.appendChild(styles);
    }

    // set the type="modeless" for the a11y enhancer
    this.setAttribute('type', 'modeless')
    this.setAttribute('dismiss-on-blur', true);

    fsAnchoredDialog.baseDialog.attachedCallback.bind(this)(openAnchoredFunction, closeAnchoredFunction)

    function openAnchoredFunction(x, y) {
      console.log('Do positioning');
    }

    function closeAnchoredFunction() {
      console.log('restore positioning');
    }
  };

  document.registerElement('fs-anchored-dialog', {prototype: fsAnchoredDialog});
})();
</script>
